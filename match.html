<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Match</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-950 text-slate-100">
  <div class="max-w-3xl mx-auto p-4">
    <a href="index.html" class="text-indigo-400 hover:underline">&larr; Back</a>
    <div id="card" class="mt-4 p-4 rounded border border-slate-800"></div>
  </div>

<script>
const SUPA_URL  = "https://yykwhpeczfapkileuxtb.supabase.co";
const SUPA_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5a3docGVjemZhcGtpbGV1eHRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMjM4NzUsImV4cCI6MjA3NzU5OTg3NX0.Sz2G1DG0CVYC9WSuYSODnH9k0_ybVluZAtRGBwb55wo";
const supa = supabase.createClient(SUPA_URL, SUPA_ANON);
const id = new URL(location.href).searchParams.get('id');
const esc = s => (s||'').replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));

async function load(){
  const { data: m, error } = await supa.from('matches').select('*').eq('id', id).single();
  if(error || !m){ document.getElementById('card').innerHTML='<div class="text-red-400">Match not found.</div>'; return; }

  const p1link = `<a class="text-indigo-400 hover:underline" href="player.html?steam_id=${encodeURIComponent(m.p1_id)}">${esc(m.p1_name||'P1')}</a>`;
  const p2link = `<a class="text-indigo-400 hover:underline" href="player.html?steam_id=${encodeURIComponent(m.p2_id)}">${esc(m.p2_name||'P2')}</a>`;
  const e1 = m.p1_elo_after ?? m.p1_elo_before ?? '-';
  const e2 = m.p2_elo_after ?? m.p2_elo_before ?? '-';
  const winner = m.winner==='1' ? p1link : (m.winner==='2' ? p2link : '—');
  const replayBtn = m.replay_url
      ? `<a class="px-3 py-2 rounded bg-indigo-600 hover:bg-indigo-500" href="${m.replay_url}" download>Download replay</a>`
      : `<span class="text-slate-500 text-sm">Replay not uploaded</span>`;

  document.getElementById('card').innerHTML = `
    <div class="space-y-3">
      <div class="text-slate-300 text-sm">${new Date(m.played_at).toLocaleString()}</div>
      <div class="text-xl font-bold">${p1link} <span class="text-slate-400">(${e1})</span> vs ${p2link} <span class="text-slate-400">(${e2})</span></div>
      <div class="text-slate-300">Winner: <span class="text-slate-100">${winner}</span> · Map ${m.map_id ?? '-'}</div>
      <div class="pt-1">${replayBtn}</div>
    </div>`;
}
load();
</script>
</body>
</html>
